<form>
  <label><b>Enter a Job Title: </b></label>
  <input type="text" name="message" id="user_input">
</form>

<input type="submit" onclick="showInput();"><br/>
<label>Your input: </label>
<p><span id='display'></span></p>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
<script language="JavaScript">

  let char2idx = new Map([
    [" ", 0],
    ["-", 1],
    [".", 2],
    ["/", 3],
    ["0", 4],
    ["1", 5],
    ["2", 6],
    ["3", 7],
    ["4", 8],
    ["5", 9],
    ["6", 10],
    ["7", 11],
    ["8", 12],
    ["9", 13],
    ["=", 14],
    ["a", 15],
    ["b", 16],
    ["c", 17],
    ["d", 18],
    ["e", 19],
    ["f", 20],
    ["g", 21],
    ["h", 22],
    ["i", 23],
    ["j", 24],
    ["k", 25],
    ["l", 26],
    ["m", 27],
    ["n", 28],
    ["o", 29],
    ["p", 30],
    ["q", 31],
    ["r", 32],
    ["s", 33],
    ["t", 34],
    ["u", 35],
    ["v", 36],
    ["w", 37],
    ["x", 38],
    ["y", 39],
    ["z", 40]
  ])

  let idx2char = new Map(Array.from(char2idx, a => a.reverse()))

  function str2Idx(str) {
    let result = []
    for (var i = 0; i < str.length; i++) {
      var ch = str.toLowerCase().charAt(i)
      var idx = char2idx.get(ch)
      result.push(idx)
    }
    console.log(result)
    return tf.tensor1d(result)
  }

  async function showInput() {
      const model = await tf.loadLayersModel("../assets/models/forwards_model/model.json", strict=false)
      var text = document.getElementById("user_input").value;
      var seed = str2Idx(text)
      seed = seed.expandDims(0)
      model.resetStates()
      text_generated = []
      for (var i = 0; i < 1000; i++) { 
        var prediction = model.predict(seed)
        prediction = prediction.squeeze(0)
        var predicted_id = tf.multinomial(prediction, 1)
        predicted_id = predicted_id.arraySync()
        predicted_id = predicted_id[predicted_id.length-1][0]
        seed = tf.tensor([predicted_id])
        seed = seed.expandDims(0)
        text_generated.push(idx2char.get(predicted_id))
      }
      var final_text = text + text_generated.join("")
      document.getElementById('display').innerHTML = final_text;
  }

</script>
